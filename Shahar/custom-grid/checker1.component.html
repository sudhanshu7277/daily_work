<div class="toast-stack">
  <div *ngFor="let t of toasts" class="toast" [ngClass]="t.type">{{ t.message }}</div>
</div>

<div class="grid-container">
  <header class="header-actions">
    <button class="btn-auth" [disabled]="!selectedRecordId" (click)="onAuthorize()">Authorize</button>
    <div class="filter-group">
      <div class="filter-item">
        <label>Date</label>
        <input type="date" [(ngModel)]="filterDate" (change)="applyFilters()">
      </div>
      <div class="filter-item">
        <label>CCY</label>
        <select [(ngModel)]="filterCCY" (change)="applyFilters()">
          <option value="">All</option>
          <option *ngFor="let c of currencies" [value]="c">{{c}}</option>
        </select>
      </div>
      <input type="text" [ngModel]="searchGlobal" (ngModelChange)="onSearchChange($event)" placeholder="Search all fields...">
      <button class="btn-reset" (click)="resetFilters()">Reset All</button>
    </div>
  </header>

  <div class="grid-card">
    <div class="scroll-container">
      <table>
        <thead>
          <tr>
            <th class="col-cb"></th>
            <th (click)="sortData('id')" class="sortable">ID ↕</th>
            <th (click)="sortData('ddaAccount')" class="sortable">DDA ACCOUNT ↕</th>
            <th (click)="sortData('valueDate')" class="sortable">DATE ↕</th>
            <th>CCY</th>
            <th class="text-right">AMOUNT ↕</th>
            <th class="col-edit">EDIT</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of pagedRecords" [class.row-selected]="selectedRecordId === row.id" (click)="toggleSelection(row, row.id)">
            <td class="col-cb">
              <input type="checkbox" [checked]="selectedRecordId === row.id" (click)="$event.stopPropagation()">
            </td>
            <td>{{row.id}}</td>
            <td>{{row.ddaAccount}}</td>
            <td>{{row.valueDate | date:'dd MMM yyyy'}}</td>
            <td>{{row.ccy}}</td>
            <td class="text-right font-mono">{{row.amount | number:'1.2-2'}}</td>
            <td class="col-edit">
              <button class="btn-edit-link" (click)="openEdit(row, $event)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <footer class="pagination-footer">
      <div class="foot-left">Total Records: {{filteredRecords.length}}</div>
      <div class="foot-center">
        <button [disabled]="currentPage === 1" (click)="setPage(currentPage - 1)">‹ Prev</button>
        <span>Page {{currentPage}} of {{totalPages}}</span>
        <button [disabled]="currentPage === totalPages" (click)="setPage(currentPage + 1)">Next ›</button>
      </div>
      <div class="foot-right">
        Go to: <input type="number" [(ngModel)]="jumpToPageValue" (keyup.enter)="setPage(jumpToPageValue)" style="width: 45px; text-align: center;">
      </div>
    </footer>
  </div>
</div>

<div class="modal-overlay" *ngIf="editingRecord">
  <div class="modal-content">
    <h3>Edit Transaction: {{editingRecord.id}}</h3>
    <div class="form-body">
      <div class="field">
        <label>DDA Account</label>
        <input [(ngModel)]="editingRecord.ddaAccount">
      </div>
      <div class="field">
        <label>Payment Amount</label>
        <input type="text" [(ngModel)]="editingRecord.amount" (keydown)="validateAmountInput($event)">
      </div>
    </div>
    <div class="modal-footer">
      <button (click)="closeEdit()">Cancel</button>
      <button class="btn-save" (click)="saveEdit()">Save Changes</button>
    </div>
  </div>
</div>