<p-toast></p-toast>

<div class="checker-container">
  <div class="header-actions">
    <button pButton label="Approve" icon="pi pi-check" class="p-button-success" 
            [disabled]="!selectedRecord" (click)="onApprove()"></button>
    <button pButton label="Edit Record" icon="pi pi-pencil" class="p-button-warning" 
            [disabled]="!selectedRecord" (click)="openEditModal()"></button>
  </div>

  <p-table [value]="gridData" [(selection)]="selectedRecord" selectionMode="single" 
           dataKey="id" [paginator]="true" [rows]="10" [loading]="loading"
           styleClass="p-datatable-sm p-datatable-gridlines">
    
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem"></th>
        <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="issueName">Issue Name <p-sortIcon field="issueName"></p-sortIcon></th>
        <th pSortableColumn="currency">Currency <p-sortIcon field="currency"></p-sortIcon></th>
        <th pSortableColumn="amount">Amount <p-sortIcon field="amount"></p-sortIcon></th>
        <th pSortableColumn="createdDate">Date <p-sortIcon field="createdDate"></p-sortIcon></th>
        <th>Status</th>
      </tr>
      <tr>
        <th></th>
        <th><p-columnFilter type="text" field="id"></p-columnFilter></th>
        <th><p-columnFilter type="text" field="issueName"></p-columnFilter></th>
        <th>
          <p-columnFilter field="currency" matchMode="equals" [showMenu]="false">
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <p-dropdown [ngModel]="value" [options]="currencies" (onChange)="filter($event.value)" 
                          placeholder="Any" [showClear]="true"></p-dropdown>
            </ng-template>
          </p-columnFilter>
        </th>
        <th><p-columnFilter type="numeric" field="amount" display="menu" currency="USD"></p-columnFilter></th>
        <th><p-columnFilter type="date" field="createdDate" display="menu"></p-columnFilter></th>
        <th></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-record>
      <tr [pSelectableRow]="record">
        <td><p-tableRadioButton [value]="record"></p-tableRadioButton></td>
        <td>{{record.id}}</td>
        <td>{{record.issueName}}</td>
        <td>{{record.currency}}</td>
        <td>{{record.amount | currency: record.currency}}</td>
        <td>{{record.createdDate | date: 'dd-MMM-yyyy'}}</td>
        <td>
          <p-tag [value]="record.status" [severity]="getSeverity(record.status)" [rounded]="true"></p-tag>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog [(visible)]="editDialog" header="Edit Record Details" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
      <div class="field">
        <label for="name">Issue Name</label>
        <input type="text" pInputText id="name" [(ngModel)]="clonedRecord.issueName" required />
      </div>
      <div class="field">
        <label for="amt">Amount</label>
        <input type="number" pInputText id="amt" [(ngModel)]="clonedRecord.amount" />
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="editDialog=false"></button>
      <button pButton label="Save Changes" icon="pi pi-check" (click)="saveEdit()"></button>
    </ng-template>
  </p-dialog>
</div>